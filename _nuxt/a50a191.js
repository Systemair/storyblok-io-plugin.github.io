(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{273:function(e,t,n){var content=n(280);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(105).default)("3f1bf8ba",content,!0,{sourceMap:!1})},279:function(e,t,n){"use strict";n(273)},280:function(e,t,n){var r=n(104)(!1);r.push([e.i,".header[data-v-7f4d7fca]{display:flex;flex-direction:row;align-items:center}.content[data-v-7f4d7fca]{display:flex;flex-direction:column;margin:8px}.back-button[data-v-7f4d7fca]:hover{background-color:rgba(0,0,0,.06275)}.back-button[data-v-7f4d7fca]:active{background-color:rgba(0,0,0,.12549)}",""]),e.exports=r},285:function(e,t,n){"use strict";n.r(t);n(41),n(28),n(63),n(34),n(64);var r,o=n(25),c=n(5),l=(n(40),n(12),n(22),n(141),n(196),n(53),n(33),n(272),n(137),n(61),n(39),n(51)),f=(n(42),n(44),n(46),n(172)),d=n(173),m=(n(27),n(29),n(45),n(77),n(276),n(136),n(278)),h=n.n(m);function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}!function(e){e.tab="tab",e.bloks="bloks",e.text="text",e.textarea="textarea",e.markdown="markdown",e.number="number",e.datetime="datetime",e.boolean="boolean",e.option="option",e.options="options",e.image="image",e.file="file",e.multiasset="multiasset",e.multilink="multilink",e.section="section",e.richtext="richtext",e._uid="uid",e.component="component"}(r||(r={}));var k=function(){function e(t,n,r){Object(f.a)(this,e),this.spaceComponents=t,this.searchStories=n,this.readStory=r,this.workbook=new h.a.Workbook,this.workbook.creator="storyblok-io-plugin",this.workbook.created=new Date,this.workbook.modified=new Date}var t,n,o,l,m,x,k;return Object(d.a)(e,[{key:"generateLayout",value:(k=Object(c.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createWorksheetFromComponent(t,!0,{tabColor:{argb:"FFFF0000"}});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"exportStory",value:(x=Object(c.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readStory(t);case 2:return n=e.sent,e.next=5,this.exportComponent(n.content,n.uuid);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"createWorksheetFromComponent",value:(m=Object(c.a)(regeneratorRuntime.mark((function e(component,t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.workbook.getWorksheet(component.name))){e.next=3;break}return e.abrupt("return",{worksheet:r,created:!1});case 3:return r=this.workbook.addWorksheet(component.name,{views:[{state:"frozen",xSplit:2,ySplit:1}],properties:n}),e.next=6,this.createColumnsFromComponentFields(component,r,t);case 6:return e.abrupt("return",{worksheet:r,created:!0});case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return m.apply(this,arguments)})},{key:"createColumnsFromComponentFields",value:(l=Object(c.a)(regeneratorRuntime.mark((function e(component,t,n){var o,c,l,f,d,m,h,x,k,y,w,C,S,header,_=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(o=new Array).push({header:"_uid",key:"_uid",width:50,style:{font:{bold:!0}}}),o.push({header:"parent_id",key:"parent_id",width:50,style:{font:{bold:!0}}}),c=0,l=Object.keys(component.schema);case 4:if(!(c<l.length)){e.next=59;break}if(f=l[c],(d=component.schema[f]).type!==r.tab){e.next=9;break}return e.abrupt("continue",56);case 9:m={header:f,key:f,_meta:d},e.t0=d.type,e.next=e.t0===r.option||e.t0===r.options?13:e.t0===r.bloks?17:55;break;case 13:if("internal_stories"!==d.source||!d.filter_content_type||!d.filter_content_type.length){e.next=16;break}return e.next=16,this.createOptionsSheet(d);case 16:return e.abrupt("break",55);case 17:if(n){e.next=19;break}return e.abrupt("break",55);case 19:if(!(h=d).component_whitelist){e.next=37;break}x=v(h.component_whitelist),e.prev=22,y=regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=k.value,!(n=_.spaceComponents.find((function(e){return e.name===t})))){e.next=5;break}return e.next=5,_.createWorksheetFromComponent(n,!0);case 5:case"end":return e.stop()}}),e)})),x.s();case 25:if((k=x.n()).done){e.next=29;break}return e.delegateYield(y(),"t1",27);case 27:e.next=25;break;case 29:e.next=34;break;case 31:e.prev=31,e.t2=e.catch(22),x.e(e.t2);case 34:return e.prev=34,x.f(),e.finish(34);case 37:if(!h.component_group_whitelist){e.next=54;break}w=v(h.component_group_whitelist),e.prev=39,S=regeneratorRuntime.mark((function e(){var t,n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=C.value,n=v(_.spaceComponents.filter((function(e){return e.component_group_uuid===t}))),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return o=r.value,e.next=8,_.createWorksheetFromComponent(o,!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])})),w.s();case 42:if((C=w.n()).done){e.next=46;break}return e.delegateYield(S(),"t3",44);case 44:e.next=42;break;case 46:e.next=51;break;case 48:e.prev=48,e.t4=e.catch(39),w.e(e.t4);case 51:return e.prev=51,w.f(),e.finish(51);case 54:return e.abrupt("break",55);case 55:o.push(m);case 56:c++,e.next=4;break;case 59:t.columns=o,(header=t.getRow(1)).eachCell((function(e,t){var meta=o[t-1]._meta;if(meta){e.note=meta.description||"";var style={font:{}};meta.required&&(style.font=Object.assign(style.font,{color:{argb:"FFFF0000"}})),e.style=style}})),header.commit();case 63:case"end":return e.stop()}}),e,this,[[22,31,34,37],[39,48,51,54]])}))),function(e,t,n){return l.apply(this,arguments)})},{key:"createOptionsSheet",value:(o=Object(c.a)(regeneratorRuntime.mark((function e(t){var n,component,o,c,l,f,d,m,h,x,k,y,option;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.filter_content_type,component=this.spaceComponents.find((function(e){return e.name===n}))){e.next=5;break}return console.error("Unknown content type '".concat(n,"'. Abort creating options.")),e.abrupt("return",void 0);case 5:return e.next=7,this.createWorksheetFromComponent(component,!1,{tabColor:{argb:"FF0000FF"}});case 7:if(o=e.sent,c=o.worksheet,!o.created){e.next=51;break}l=!1,f=0,d=Object.keys(component.schema);case 13:if(!(f<d.length)){e.next=26;break}m=d[f],h=component.schema[m],e.t0=h.type,e.next=e.t0===r.option||e.t0===r.options||e.t0===r.file||e.t0===r.image||e.t0===r.multilink||e.t0===r.multiasset?19:21;break;case 19:return l=!0,e.abrupt("break",21);case 21:if(!l){e.next=23;break}return e.abrupt("break",26);case 23:f++,e.next=13;break;case 26:return e.next=28,this.searchStories({"filter_query[component][in]":n,story_only:1,with_summary:l?0:1});case 28:x=e.sent,k=v(x),e.prev=30,k.s();case 32:if((y=k.n()).done){e.next=43;break}if(option=y.value,!l){e.next=39;break}return e.next=37,this.exportStory(option.id);case 37:e.next=41;break;case 39:return e.next=41,this.exportComponent(option.content_summary,option.uuid);case 41:e.next=32;break;case 43:e.next=48;break;case 45:e.prev=45,e.t1=e.catch(30),k.e(e.t1);case 48:return e.prev=48,k.f(),e.finish(48);case 51:return e.abrupt("return",c);case 52:case"end":return e.stop()}}),e,this,[[30,45,48,51]])}))),function(e){return o.apply(this,arguments)})},{key:"fitWorksheetColumns",value:function(e){e.columns.forEach((function(e){var t=0;e.eachCell({includeEmpty:!1},(function(e){t=Math.max(t,e.value?e.value.toString().length:0)})),e.width=Math.max(10,t)}))}},{key:"exportComponent",value:(n=Object(c.a)(regeneratorRuntime.mark((function e(component,t){var n,o,c,l,f,d,m,h,x,k,y,w,C,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=component.component,o=this.spaceComponents.find((function(e){return e.name===n})),c=function(e){return"_uid"===e?{type:r._uid}:"component"===e?{type:r.component}:null==o?void 0:o.schema[e]},l=this.workbook.getWorksheet(n)){e.next=7;break}return console.error("Unknown component '".concat(n,"' encountered.")),e.abrupt("return");case 7:f={parent_id:t},d=0,m=Object.keys(component);case 9:if(!(d<m.length)){e.next=52;break}if(h=m[d],!(x=c(h))){e.next=48;break}k=component[h],e.t0=x.type,e.next=e.t0===r._uid?17:e.t0===r.bloks?19:e.t0===r.datetime?39:e.t0===r.options?41:44;break;case 17:return f=Object.assign(f,{_uid:k}),e.abrupt("break",46);case 19:w=v(y=k),e.prev=21,w.s();case 23:if((C=w.n()).done){e.next=29;break}return S=C.value,e.next=27,this.exportComponent(S,component._uid);case 27:e.next=23;break;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(21),w.e(e.t1);case 34:return e.prev=34,w.f(),e.finish(34);case 37:return f=Object.defineProperty(f,h,{value:y.map((function(e){return e._uid})).join(", ")}),e.abrupt("break",46);case 39:return f=Object.defineProperty(f,h,{value:k?new Date(k):void 0}),e.abrupt("break",46);case 41:if("internal_stories"!==x.source){e.next=44;break}return f=Object.defineProperty(f,h,{value:k.join(", ")}),e.abrupt("break",46);case 44:return f=Object.defineProperty(f,h,{value:k}),e.abrupt("break",46);case 46:e.next=49;break;case 48:console.warn("Found field '".concat(h,"' in component '").concat(n,"', but it is not defined in StoryBlok schema. Field will be ignored."),component);case 49:d++,e.next=9;break;case 52:l.addRow(f);case 53:case"end":return e.stop()}}),e,this,[[21,31,34,37]])}))),function(e,t){return n.apply(this,arguments)})},{key:"applyDataValidations",value:function(e){var t,n=this,o=this.spaceComponents.find((function(t){return t.name===e.name})),c=v(e.columns);try{var l=function(){var e=t.value,c=function(e){if(void 0!==e)return"_uid"===e?{type:r._uid}:"component"===e?{type:r.component}:null==o?void 0:o.schema[e]}(e.key);if(void 0===c)return"continue";switch(c.type){case r.option:case r.options:var l=n.workbook.getWorksheet(c.filter_content_type||"");if(l){var f=l.getColumn("name").letter;e.eachCell((function(e,t){var n;if(t<=1)e.value={text:e.text,hyperlink:"#'".concat(l.name,"'!A1")};else{if(c.type===r.options)return;if(e.value){var o=0;l.getColumn("parent_id").eachCell((function(t,n){o||t.value!=e.value||(o=n)}));var d=o?l.getCell("".concat(f,":").concat(o)).value:void 0;d&&(e.value=d)}e.dataValidation={type:"list",allowBlank:!0,formulae:["'".concat(l.name,"'!$").concat(f,"$2:$").concat(f,"$").concat(null===(n=l.lastRow)||void 0===n?void 0:n.number)]}}}))}}};for(c.s();!(t=c.n()).done;)l()}catch(e){c.e(e)}finally{c.f()}}},{key:"save",value:(t=Object(c.a)(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=v(this.workbook.worksheets);try{for(n.s();!(r=n.n()).done;)o=r.value,this.applyDataValidations(o),this.fitWorksheetColumns(o)}catch(e){n.e(e)}finally{n.f()}return e.next=4,this.workbook.xlsx.writeBuffer().then((function(data){var e=window.document.createElement("a");return e.href=window.URL.createObjectURL(new Blob([data],{type:"application/octet-stream"})),e.download=null!=t?t:"Untiteled-".concat((new Date).toISOString(),".xlsx"),document.body.appendChild(e),e.click(),window.URL.revokeObjectURL(e.href),document.body.removeChild(e),!0})).catch((function(e){return console.error(e),!1}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function y(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function w(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var C={data:function(){return{contentTypes:[],contentType:void 0,contentFolders:[],search:"",breadcrumbs:[],loadingComponents:!1,loadingContentFolder:!1,exporting:!1,exportProgressIndicatorType:"spinner",exportProgress:0,exportStatus:""}},mounted:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loadingComponents=!0,t.next=3,e.components();case 3:return e.contentTypes=t.sent,e.loadingComponents=!1,e.loadingContentFolder=!0,t.next=8,e.getContentFolder(0);case 8:e.contentFolders=t.sent,e.loadingContentFolder=!1;case 10:case"end":return t.stop()}}),t)})))()},computed:{contentFoldersFiltered:function(){var e=this;return this.contentFolders.filter((function(t){return t.label.toLowerCase().search(e.search)>-1}))}},methods:w(w({},Object(l.c)("storyblok",["components","searchStories","readStory"])),{},{onContentFolderSelected:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.search="",t.breadcrumbs.push(e),n.next=4,t.syncBreadcrumbs();case 4:case"end":return n.stop()}}),n)})))()},onNavigate:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.breadcrumbs=t.breadcrumbs.splice(0,e+1),n.next=3,t.syncBreadcrumbs();case 3:case"end":return n.stop()}}),n)})))()},onClearNavigation:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.breadcrumbs=[],t.next=3,e.syncBreadcrumbs();case 3:case"end":return t.stop()}}),t)})))()},getContentFolder:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.searchStories({with_parent:e,folder_only:1}).then((function(e){return e.map((function(e){return{label:e.name,value:{id:e.id,slug:e.slug},isParent:!0}}))})));case 1:case"end":return n.stop()}}),n)})))()},syncBreadcrumbs:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loadingContentFolder=!0,n=e.breadcrumbs[e.breadcrumbs.length-1],t.next=4,e.getContentFolder(n?n.value.id:0);case 4:e.contentFolders=t.sent,e.loadingContentFolder=!1;case 6:case"end":return t.stop()}}),t)})))()},filterContentFolder:function(e){this.search=e.value.toLowerCase(),console.log(this.search)},exportData:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var n,r,o,c,l,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.exporting=!0,e.exportProgress=0,e.exportStatus="",e.exportProgressIndicatorType="spinner",t.next=6,e.components();case 6:return n=t.sent,r=n.find((function(component){return component.name===e.contentType})),o=e.breadcrumbs.map((function(e){return e.value.slug})).join("/"),c=new k(n,e.searchStories,e.readStory),e.exportStatus="Prepare Excel sheet layout for content type '".concat(e.contentType,"' ..."),t.next=13,c.generateLayout(r);case 13:return e.exportStatus="Retrieving all stories of content type '".concat(e.contentType,"' from root folder '").concat(o,"' ..."),t.next=16,e.searchStories({"filter_query[component][in]":e.contentType,starts_with:o,story_only:1});case 16:l=t.sent,e.exportProgressIndicatorType="bar",i=0;case 19:if(!(i<l.length)){t.next=27;break}return e.exportProgress=i/l.length*100,e.exportStatus="Exporting '".concat(l[i].full_slug,"' ..."),t.next=24,c.exportStory(l[i].id);case 24:i++,t.next=19;break;case 27:return e.exportStatus="Saving Excel file ...",t.next=30,c.save("".concat(e.contentType,"-").concat((new Date).toISOString(),".xlsx"));case 30:e.exporting=!1;case 31:case"end":return t.stop()}}),t)})))()}})},S=C,_=(n(279),n(54)),component=Object(_.a)(S,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("SbModal",{attrs:{isOpen:e.exporting,"full-width":""},on:{hide:function(t){e.exporting=!1}}},[n("SbModalHeader",{attrs:{title:"Exporting data..."}}),e._v(" "),n("SbModalContent",[n("SbLoading",{attrs:{value:e.exportProgress,type:e.exportProgressIndicatorType,"show-percentage":"bar"===e.exportProgressIndicatorType}}),e._v(" "),n("p",{staticStyle:{"text-align":"center"}},[e._v(e._s(e.exportStatus))])],1)],1),e._v(" "),n("SbCard",[n("SbCardHeader",{staticClass:"header"},[n("SbIcon",{staticClass:"back-button",attrs:{size:"large",name:"chevron-back"},on:{click:function(t){return e.$router.go(-1)}}}),e._v(" "),n("h3",[e._v("Export Data")])],1),e._v(" "),n("SbCardContent",{staticClass:"content"},[n("SbFormItem",{attrs:{label:"Content Type","helper-icon-text":"Select a content type you want to export."}},[n("SbSelect",{staticStyle:{"max-width":"300px"},attrs:{options:e.contentTypes,label:"",isLoading:e.loadingComponents,itemLabel:"name",itemValue:"name",filterable:""},model:{value:e.contentType,callback:function(t){e.contentType=t},expression:"contentType"}})],1),e._v(" "),n("SbFormItem",{attrs:{label:"Content Folder","helper-icon-text":"Select a root content folder from where all stories with that content type will be export from."}},[n("SbSelect",{attrs:{label:e.breadcrumbs.map((function(b){return b.label})).join("/")}},[n("SbMinibrowser",{staticStyle:{"background-color":"white"},attrs:{slot:"minibrowser",notFoundPrefix:"",options:e.contentFoldersFiltered,breadcrumbs:e.breadcrumbs,isExpanded:"",isLoading:e.loadingContentFolder},on:{filter:e.filterContentFolder,"select-item":e.onContentFolderSelected,navigate:e.onNavigate,"clear-navigation":e.onClearNavigation},slot:"minibrowser"})],1)],1)],1),e._v(" "),n("SbCardFooter",[n("SbButton",{attrs:{label:"Export",isDisabled:!e.contentType},on:{click:e.exportData}})],1)],1)],1)}),[],!1,null,"7f4d7fca",null);t.default=component.exports}}]);