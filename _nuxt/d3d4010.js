(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{345:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return w}));r(33),r(41),r(53),r(54),r(55),r(63),r(26),r(65),r(75);var n,o=r(23),c=r(6),l=r(17),f=r(18),h=(r(64),r(35),r(46),r(232),r(9),r(38),r(44),r(39),r(161),r(34),r(43),r(42),r(346),r(163),r(344)),d=r.n(h);function m(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function k(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function y(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}!function(e){e.tab="tab",e.bloks="bloks",e.text="text",e.textarea="textarea",e.markdown="markdown",e.number="number",e.datetime="datetime",e.boolean="boolean",e.option="option",e.options="options",e.image="image",e.file="file",e.multiasset="multiasset",e.multilink="multilink",e.section="section",e.richtext="richtext",e._uid="uid",e.component="component",e.name="name"}(n||(n={}));var w=function(){function e(t){Object(l.a)(this,e),this.workbook=new d.a.Workbook,this.vuexStore=t}var t,r,o,h;return Object(f.a)(e,[{key:"spaceComponents",get:function(){return this.vuexStore.state.storyblok.components}},{key:"searchStories",value:(h=Object(c.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.vuexStore.dispatch("storyblok/searchStories",t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"readStory",value:(o=Object(c.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.vuexStore.dispatch("storyblok/readStory",t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getWorksheetNames",value:function(){return this.workbook.worksheets.map((function(s){return s.name}))}},{key:"getWorksheetColumns",value:function(e){return this.workbook.getWorksheet(e).columns}},{key:"getRootContentTypeWorksheet",value:function(){return this.workbook.getWorksheet(1)}},{key:"getContentTypeSchema",value:function(e){var t;return(null===(t=this.spaceComponents.find((function(t){return t.name===e})))||void 0===t?void 0:t.schema)||{}}},{key:"asStory",value:function(e){var t=this.getRootContentTypeWorksheet().getRow(e),content=this.componentRowToObject(t);return y(y({},this.storyRowToObject(t)),{},{content:content})}},{key:"storyRowToObject",value:function(e){return{uuid:e.getCell("parent_id").text,parent_id:e.getCell("_SB_parent_id").text,name:e.getCell("_SB_name").text,slug:e.getCell("_SB_slug").text,full_slug:e.getCell("_SB_full_slug").text,is_startpage:e.getCell("_SB_is_startpage").text,updated_at:e.getCell("_SB_updated_at").text,published:e.getCell("_SB_published").text}}},{key:"componentRowToObject",value:function(e){for(var t=this.getContentTypeSchema(e.worksheet.name),r=function(e){return"_uid"===e?{type:n._uid}:"component"===e?{type:n.component}:t[e]},content={},o=0,c=Object.keys(t);o<c.length;o++){var l=c[o],f=r(l);if(f.type!==n.tab){var h=e.getCell(e.worksheet.getColumn(l).letter).text;switch(f.type){case n._uid:break;case n.option:var d=this.workbook.getWorksheet(f.filter_content_type||""),m=d.getColumn("parent_id").letter,v=d.getColumn("name").values.indexOf(h);content[l]=d.getCell("".concat(m,":").concat(v)).text;break;case n.options:content[l]=h.split(",").map((function(e){return e.trim()}));break;case n.bloks:break;default:try{content[l]=JSON.parse(h)}catch(e){content[l]=h}}}}return Object.assign(content,{component:e.worksheet.name})}},{key:"addDataValidations",value:function(e){var t,r=this,o=this.spaceComponents.find((function(t){return t.name===e.name})),c=m(e.columns);try{var l=function(){var e=t.value,c=function(e){if(void 0!==e)return"_uid"===e?{type:n._uid}:"component"===e?{type:n.component}:null==o?void 0:o.schema[e]}(e.key);if(void 0===c)return"continue";switch(c.type){case n.option:case n.options:var l=r.workbook.getWorksheet(c.filter_content_type||"");if(l){var f=l.getColumn("name").letter;e.eachCell((function(e,t){var r;if(t<=1)e.value={text:e.text,hyperlink:"#'".concat(l.name,"'!A1")};else{if(c.type===n.options)return;if(e.value){var o=0;l.getColumn("parent_id").eachCell((function(t,r){o||t.value!=e.value||(o=r)}));var h=o?l.getCell("".concat(f,":").concat(o)).value:void 0;h&&(e.value=h)}e.dataValidation={type:"list",allowBlank:!0,formulae:["'".concat(l.name,"'!$").concat(f,"$2:$").concat(f,"$").concat(null===(r=l.lastRow)||void 0===r?void 0:r.number)]}}}))}}};for(c.s();!(t=c.n()).done;)l()}catch(e){c.e(e)}finally{c.f()}}},{key:"fitWorksheetColumns",value:function(e){e.columns.forEach((function(e){var t=0;e.eachCell({includeEmpty:!1},(function(e){t=Math.max(t,e.value?e.value.toString().length:0)})),e.width=Math.max(10,t)}))}},{key:"save",value:(r=Object(c.a)(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=m(this.workbook.worksheets);try{for(r.s();!(n=r.n()).done;)o=n.value,this.addDataValidations(o),this.fitWorksheetColumns(o)}catch(e){r.e(e)}finally{r.f()}return e.next=4,this.workbook.xlsx.writeBuffer().then((function(data){var e=window.document.createElement("a");return e.href=window.URL.createObjectURL(new Blob([data],{type:"application/octet-stream"})),e.download=null!=t?t:"Untiteled-".concat((new Date).toISOString(),".xlsx"),document.body.appendChild(e),e.click(),window.URL.revokeObjectURL(e.href),document.body.removeChild(e),!0})).catch((function(e){return console.error(e),!1}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"load",value:(t=Object(c.a)(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.workbook=new d.a.Workbook,e.next=3,new Promise((function(e,r){var n=new FileReader;n.onload=function(t){return e(n.result)},n.onerror=function(e){return r(e)},n.readAsArrayBuffer(t)})).then((function(data){return r.workbook.xlsx.load(data)})).then((function(){var e;if(r.workbook){var t,n=m(r.workbook.worksheets);try{for(n.s();!(t=n.n()).done;){var o,c=t.value,l=c.getRow(1),f=m(c.columns);try{for(f.s();!(o=f.n()).done;){var h=o.value;h.key=null===(e=l.findCell(h.number))||void 0===e?void 0:e.text}}catch(e){f.e(e)}finally{f.f()}}}catch(e){n.e(e)}finally{n.f()}}}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}()},355:function(e,t,r){var content=r(441);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(108).default)("aafe1d78",content,!0,{sourceMap:!1})},440:function(e,t,r){"use strict";r(355)},441:function(e,t,r){var n=r(107)(!1);n.push([e.i,".workbook-tabs[data-v-207cda68]{overflow:scroll}.workbook[data-v-207cda68]{margin-top:8px}.workbook-header[data-v-207cda68]{width:250px;min-width:250px;max-width:250px;padding:0 16px;font-size:1.25rem;color:rgba(0,0,0,.50196);text-transform:uppercase}.workbook-header[data-v-207cda68],.workbook-header-mapping[data-v-207cda68]{text-align:left;vertical-align:middle;height:48px;border-bottom:1px solid rgba(0,0,0,.25)}.workbook-header-mapping[data-v-207cda68]{padding-left:16px}.workbook-sheet-cell[data-v-207cda68]{height:48px;padding:4px 16px;font-size:1.1rem;border-bottom:1px solid rgba(0,0,0,.15)}",""]),e.exports=n},453:function(e,t,r){"use strict";r.r(t);var n=r(450),o=(r(26),r(48),r(33),r(41),r(53),r(34),r(54),r(43),r(63),r(65),r(75),r(13)),c=r(155),l=r(23),f=r(6),h=(r(35),r(38),r(9),r(42),r(44),r(232),r(55),r(62),r(76),r(39),r(64),r(67)),d=(r(68),r(18)),m=r(17),v=r(28),k=r(25),y=r(14);function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(y.a)(e);if(t){var o=Object(y.a)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Object(k.a)(this,r)}}var x=function(e){Object(v.a)(r,e);var t=w(r);function r(e){return Object(m.a)(this,r),t.call(this,e)}return Object(d.a)(r)}(r(345).b);function O(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function j(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function C(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(t){Object(l.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var S={data:function(){return{importerInstance:void 0,preparing:!1,currentWorksheet:void 0,worksheets:[],headers:[],items:[],pseudo:0,mappings:void 0,validWorkbookMapping:!1}},mounted:function(){var e=this;return Object(f.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.prepareMappingTable();case 2:case"end":return t.stop()}}),t)})))()},computed:C(C(C({},Object(h.d)("import",["xlsxFile","worksheetColumnMappings"])),Object(h.d)("storyblok",["components"])),{},{mapping:function(){return this.mappings[this.currentWorksheet]}}),methods:C(C(C({},Object(h.e)("import",["setImporter","setWorksheetColumnMappings"])),Object(h.c)("import",["getImporter"])),{},{prepareMappingTable:function(){var e=this;return Object(f.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preparing=!0,t.next=3,e.getImporter();case 3:if(e.importerInstance=t.sent,!e.importerInstance){t.next=14;break}e.worksheets=e.importerInstance.getWorksheetNames(),e.currentWorksheet=null===(r=e.importerInstance.getRootContentTypeWorksheet())||void 0===r?void 0:r.name,e.mappings=JSON.parse(JSON.stringify(e.worksheetColumnMappings)),e.validateWorkbookMapping(),e.onWorksheetChanged(e.currentWorksheet),e.pseudo++,e.preparing=!1,t.next=17;break;case 14:return n=new x(e.$store),t.next=17,n.load(e.xlsxFile).then(Object(f.a)(regeneratorRuntime.mark((function t(){var r,l,f,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.worksheets=n.getWorksheetNames(),e.currentWorksheet=null===(r=n.getRootContentTypeWorksheet())||void 0===r?void 0:r.name,e.mappings={},l=O(e.worksheets),t.prev=4,h=regeneratorRuntime.mark((function t(){var r,l,h,component,d,m,v,k,y,w,x,_,j,header,C;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=f.value,l=e.currentWorksheet===r,e.mappings[r]={options:[],columns:{},errors:{}},h=l?["_SB_parent_id","_SB_name","_SB_slug","_SB_full_slug","_SB_is_startpage","_SB_updated_at","_SB_published"]:[],component=e.components.find((function(e){return e.name===r})),d=0,m=Object.keys(component.schema);d<m.length;d++)v=m[d],"tab"!==component.schema[v].type&&h.push(v);k={},y=O(n.getWorksheetColumns(r));try{for(y.s();!(w=y.n()).done;)x=w.value,x.letter,_=x.values,j=Object(c.a)(_),j[0],header=j[1],j.slice(2),C="object"===Object(o.a)(header)?header.text:header,h.includes(C)&&(k[C]=C)}catch(e){y.e(e)}finally{y.f()}e.mappings[r].options=h,e.mappings[r].columns=k,e.validateMapping(r);case 12:case"end":return t.stop()}}),t)})),l.s();case 7:if((f=l.n()).done){t.next=11;break}return t.delegateYield(h(),"t0",9);case 9:t.next=7;break;case 11:t.next=16;break;case 13:t.prev=13,t.t1=t.catch(4),l.e(t.t1);case 16:return t.prev=16,l.f(),t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[4,13,16,19]])})))).then((function(){e.setImporter(n),e.importerInstance=n})).then((function(){e.onWorksheetChanged(e.currentWorksheet),e.pseudo++})).finally((function(){return e.preparing=!1}));case 17:case"end":return t.stop()}}),t)})))()},validateWorkbookMapping:function(){this.validWorkbookMapping=!0;var e,t=O(this.worksheets);try{for(t.s();!(e=t.n()).done;){var r=e.value;if(this.mappings[r])for(var n=0,o=Object.keys(this.mappings[r].columns);n<o.length;n++){var c=o[n];if(this.mappings[r].errors[c])return void(this.validWorkbookMapping=!1)}}}catch(e){t.e(e)}finally{t.f()}},validate:function(){var e=this;return Object(f.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setWorksheetColumnMappings(e.mappings),t.next=3,e.$router.push({path:"/import/validate"});case 3:case"end":return t.stop()}}),t)})))()},onMappingChanged:function(e,t,r){this.mappings[e].columns[t]!==r&&(this.mappings[e].columns[t]=r,this.validateMapping(e),this.pseudo++)},validateMapping:function(e){for(var t=Object.keys(this.mappings[e].columns),i=0;i<t.length;i++){var r=t[i];delete this.mappings[e].errors[r];for(var n=i;n<t.length;n++)if(i!==n){var o=t[n];if(this.mappings[e].columns[r]===this.mappings[e].columns[o]){this.mappings[e].errors[r]="Field '".concat(this.mappings[e].columns[r],"' is already mapped by column '").concat(o,"'");break}}}this.validateWorkbookMapping()},onWorksheetChanged:function(e){var t=this;return Object(f.a)(regeneratorRuntime.mark((function r(){var n,f,h,d,m,v,k,header,y,w,x,_,j;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=2;break}return r.abrupt("return");case 2:t.headers=[],t.items=[],11,n=t.importerInstance.getWorksheetColumns(e),f=O(n);try{for(f.s();!(h=f.n()).done;)for(d=h.value,m=d.letter,v=d.values,k=Object(c.a)(v),k[0],header=k[1],y=k.slice(2),w="object"===Object(o.a)(header)?header.text:header,x="".concat(m,": ").concat(w),_="".concat(w),["_uid","parent_id"].includes(w)||t.headers.push({text:x,value:_,sortable:!1,filterable:!1}),j=0;j<Math.min(d._worksheet._rows.length,11)-1;j++)t.items.length<j+1?t.items.push(Object(l.a)({},_,y[j])):t.items[j]=Object.assign(t.items[j],Object(l.a)({},_,y[j]))}catch(e){f.e(e)}finally{f.f()}case 8:case"end":return r.stop()}}),r)})))()}})},W=(r(440),r(77)),R=Object(W.a)(S,(function(){var e=this,t=e._self._c;return t("div",[t("SbCard",[t("SbCardHeader",{staticClass:"header"},[t("SbIcon",{staticClass:"back-button",attrs:{size:"large",name:"chevron-back"},on:{click:function(t){return e.$router.go(-1)}}}),e._v(" "),t("h3",[e._v("Map Columns")])],1),e._v(" "),e.preparing?t("SbLoading",{staticStyle:{"align-items":"center"},attrs:{type:"spinner",uiBlock:""}}):e._e(),e._v(" "),e.worksheets.length?t("SbTabs",{staticClass:"workbook-tabs",on:{input:e.onWorksheetChanged},model:{value:e.currentWorksheet,callback:function(t){e.currentWorksheet=t},expression:"currentWorksheet"}},e._l(e.worksheets,(function(e){return t("SbTab",{key:e,attrs:{label:e,name:e}})})),1):e._e(),e._v(" "),e.worksheets.length?t(n.a,{staticClass:"workbook",attrs:{headers:e.headers,items:e.items,"hide-default-footer":"","hide-default-header":""},scopedSlots:e._u([{key:"header",fn:function(r){var n=r.props;return e._l(n.headers,(function(header,r){return t("th",{key:r,staticClass:"workbook-header"},[e._v(e._s(header.text))])}))}},{key:"body",fn:function(r){var n=r.items,o=r.headers;return[t("tr",e._l(o,(function(header,r){return t("td",{key:r,staticClass:"workbook-header-mapping"},[t("SbSelect",{key:e.pseudo,staticStyle:{margin:"4px 0px"},attrs:{options:e.mapping.options,label:e.mapping.columns[header.value]},on:{input:function(t){return e.onMappingChanged(e.currentWorksheet,header.value,t)}}}),e._v(" "),e.mapping.errors[header.value]?t("span",{staticClass:"text-red text-truncated"},[e._v(e._s(e.mapping.errors[header.value]))]):e._e()],1)})),0),e._v(" "),e._l(n,(function(r,n){return t("tr",{key:n+1e3},e._l(o,(function(header,c){return t("td",{key:n*o.length+c,staticClass:"workbook-sheet-cell"},[e._v("\n                        "+e._s(r[header.value])+"\n                    ")])})),0)}))]}}],null,!1,3044297038)}):e._e(),e._v(" "),t("SbCardFooter",[t("SbButton",{staticStyle:{"margin-right":"8px"},attrs:{label:"Cancel",variant:"ghost"},on:{click:function(t){return e.$router.replace({path:"/"})}}}),e._v(" "),t("SbButton",{attrs:{label:"Validate",isDisabled:!e.validWorkbookMapping},on:{click:e.validate}})],1)],1)],1)}),[],!1,null,"207cda68",null);t.default=R.exports}}]);