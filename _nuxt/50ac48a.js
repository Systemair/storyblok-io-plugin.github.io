(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{273:function(e,t,n){var content=n(280);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(105).default)("8a9e4408",content,!0,{sourceMap:!1})},279:function(e,t,n){"use strict";n(273)},280:function(e,t,n){var r=n(104)(!1);r.push([e.i,".header[data-v-4f756da6]{display:flex;flex-direction:row;align-items:center}.content[data-v-4f756da6]{display:flex;flex-direction:column;margin:8px}",""]),e.exports=r},285:function(e,t,n){"use strict";n.r(t);n(41),n(28),n(63),n(34),n(64);var r,o=n(25),c=n(5),l=(n(40),n(12),n(22),n(141),n(196),n(53),n(33),n(272),n(137),n(61),n(39),n(51)),d=(n(42),n(44),n(46),n(172)),f=n(173),m=(n(45),n(77),n(27),n(29),n(276),n(136),n(278)),h=n.n(m);function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}!function(e){e.tab="tab",e.bloks="bloks",e.text="text",e.textarea="textarea",e.markdown="markdown",e.number="number",e.datetime="datetime",e.boolean="boolean",e.option="option",e.options="options",e.image="image",e.file="file",e.multiasset="multiasset",e.multilink="multilink",e.section="section",e.richtext="richtext",e._uid="uid",e.component="component"}(r||(r={}));var w=function(){function e(t,n){Object(d.a)(this,e),this.spaceComponents=t,this.workbook=new h.a.Workbook,this.workbook.creator="storyblok-io-plugin",this.workbook.created=new Date,this.workbook.modified=new Date,this.storyWorksheet=this.workbook.addWorksheet("Stories",{views:[{state:"frozen",xSplit:1,ySplit:1}],properties:{tabColor:{argb:"FFFF0000"}}}),this.storyWorksheet.columns=[{header:"uuid",key:"uuid",style:{font:{bold:!0}}},{header:"name",key:"name",width:50},{header:"slug",key:"slug",width:50},{header:"full_slug",key:"full_slug",width:100},{header:"is_startpage",key:"is_startpage"},{header:"updated_at",key:"updated_at"},{header:"published",key:"published"}],this.createWorksheetFromComponent(n,{tabColor:{argb:"FFFFFF00"}})}var t;return Object(f.a)(e,[{key:"createWorksheetFromComponent",value:function(component,e){if(!this.workbook.getWorksheet(component.name)){var t=this.workbook.addWorksheet(component.name,{views:[{state:"frozen",xSplit:2,ySplit:1}],properties:e});this.createColumnsFromComponentFields(component,t)}}},{key:"createColumnsFromComponentFields",value:function(component,e){var t=this,n=new Array;n.push({header:"_uid",key:"_uid",width:50,style:{font:{bold:!0}}}),n.push({header:"parent_id",key:"parent_id",width:50,style:{font:{bold:!0}}});for(var o=0,c=Object.keys(component.schema);o<c.length;o++){var l=c[o],d=component.schema[l];if(d.type!==r.tab&&(n.push({header:l,key:l}),d.type===r.bloks)){var f=d;if(f.component_whitelist){var m,h=y(f.component_whitelist);try{var v=function(){var e=m.value,n=t.spaceComponents.find((function(t){return t.name===e}));n&&t.createWorksheetFromComponent(n)};for(h.s();!(m=h.n()).done;)v()}catch(e){h.e(e)}finally{h.f()}}if(f.component_group_whitelist){var w,k=y(f.component_group_whitelist);try{var x=function(){var e,n=w.value,r=y(t.spaceComponents.filter((function(e){return e.component_group_uuid===n})));try{for(r.s();!(e=r.n()).done;){var o=e.value;t.createWorksheetFromComponent(o)}}catch(e){r.e(e)}finally{r.f()}};for(k.s();!(w=k.n()).done;)x()}catch(e){k.e(e)}finally{k.f()}}}}e.columns=n;var C=e.getRow(1);C.eachCell((function(e,t){var n,r=null===(n=component.schema[Object.keys(component.schema).find((function(t){return t===e.value}))])||void 0===n?void 0:n.description;r&&(e.note=r)})),C.commit()}},{key:"fitWorksheetColumns",value:function(e){e.columns.forEach((function(e){var t=0;e.eachCell({includeEmpty:!1},(function(e){t=Math.max(t,e.value?e.value.toString().length:0)})),e.width=Math.max(10,t)}))}},{key:"exportStory",value:function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];this.storyWorksheet.getColumnKey(o)&&(t=Object.defineProperty(t,o,{value:e[o]}))}this.storyWorksheet.addRow(t),this.exportComponent(e.content,e.uuid)}},{key:"exportComponent",value:function(component,e){var t=component.component,n=this.spaceComponents.find((function(e){return e.name===t})),o=function(e){return"_uid"===e?{type:r._uid}:"component"===e?{type:r.component}:null==n?void 0:n.schema[e]},c=this.workbook.getWorksheet(t);if(c){for(var l={parent_id:e},d=0,f=Object.keys(component);d<f.length;d++){var m=f[d],h=o(m);if(h){var v=component[m];switch(h.type){case r._uid:l=Object.assign(l,{_uid:v});break;case r.bloks:var w,k=v,x=y(k);try{for(x.s();!(w=x.n()).done;){var C=w.value;this.exportComponent(C,component._uid)}}catch(e){x.e(e)}finally{x.f()}l=Object.defineProperty(l,m,{value:k.map((function(e){return e._uid})).join(", ")});break;case r.datetime:l=Object.defineProperty(l,m,{value:v?new Date(v):void 0});break;default:l=Object.defineProperty(l,m,{value:v})}}else console.warn("Found field '".concat(m,"' in component '").concat(t,"', but it is not defined in StoryBlok schema. Field will be ignored."),component)}c.addRow(l)}else console.error("Unknown component '".concat(t,"' encountered."))}},{key:"save",value:(t=Object(c.a)(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this.workbook.worksheets);try{for(n.s();!(r=n.n()).done;)o=r.value,this.fitWorksheetColumns(o)}catch(e){n.e(e)}finally{n.f()}return e.next=4,this.workbook.xlsx.writeBuffer().then((function(data){var e=window.document.createElement("a");return e.href=window.URL.createObjectURL(new Blob([data],{type:"application/octet-stream"})),e.download=null!=t?t:"Untiteled-".concat((new Date).toISOString(),".xlsx"),document.body.appendChild(e),e.click(),window.URL.revokeObjectURL(e.href),document.body.removeChild(e),!0})).catch((function(e){return console.error(e),!1}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function k(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function x(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var C={data:function(){return{contentTypes:[],contentType:void 0,contentFolders:[],search:"",breadcrumbs:[],loadingComponents:!1,loadingContentFolder:!1,exporting:!1,exportProgress:0,exportStatus:""}},mounted:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loadingComponents=!0,t.next=3,e.components();case 3:return e.contentTypes=t.sent,e.loadingComponents=!1,e.loadingContentFolder=!0,t.next=8,e.getContentFolder(0);case 8:e.contentFolders=t.sent,e.loadingContentFolder=!1;case 10:case"end":return t.stop()}}),t)})))()},computed:{contentFoldersFiltered:function(){var e=this;return this.contentFolders.filter((function(t){return t.label.toLowerCase().search(e.search)>-1}))}},methods:x(x({},Object(l.c)("storyblok",["components","searchStories","readStory"])),{},{onContentFolderSelected:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.search="",t.breadcrumbs.push(e),n.next=4,t.syncBreadcrumbs();case 4:case"end":return n.stop()}}),n)})))()},onNavigate:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.breadcrumbs=t.breadcrumbs.splice(0,e+1),n.next=3,t.syncBreadcrumbs();case 3:case"end":return n.stop()}}),n)})))()},onClearNavigation:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.breadcrumbs=[],t.next=3,e.syncBreadcrumbs();case 3:case"end":return t.stop()}}),t)})))()},getContentFolder:function(e){var t=this;return Object(c.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.searchStories({with_parent:e,folder_only:1}).then((function(e){return e.map((function(e){return{label:e.name,value:{id:e.id,slug:e.slug},isParent:!0}}))})));case 1:case"end":return n.stop()}}),n)})))()},syncBreadcrumbs:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loadingContentFolder=!0,n=e.breadcrumbs[e.breadcrumbs.length-1],t.next=4,e.getContentFolder(n?n.value.id:0);case 4:e.contentFolders=t.sent,e.loadingContentFolder=!1;case 6:case"end":return t.stop()}}),t)})))()},filterContentFolder:function(e){this.search=e.value.toLowerCase(),console.log(this.search)},exportData:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var n,r,o,c,l,i,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.exporting=!0,e.exportProgress=0,e.exportStatus="",t.next=5,e.components();case 5:return n=t.sent,r=n.find((function(component){return component.name===e.contentType})),o=e.breadcrumbs.map((function(e){return e.value.slug})).join("/"),c=new w(n,r),e.exportStatus="Retrieving all stories with content type '".concat(r,"' from root folder '").concat(o,"' ..."),t.next=12,e.searchStories({"filter_query[component][in]":e.contentType,starts_with:o,story_only:1});case 12:l=t.sent,i=0;case 14:if(!(i<l.length)){t.next=24;break}return e.exportProgress=i/l.length*100,e.exportStatus="Exporting '".concat(l[i].full_slug,"' ..."),t.next=19,e.readStory({storyId:l[i].id});case 19:d=t.sent,c.exportStory(d);case 21:i++,t.next=14;break;case 24:return e.exportStatus="Saving Excel file ...",t.next=27,c.save("".concat(e.contentType,"-").concat((new Date).toISOString(),".xlsx"));case 27:e.exporting=!1;case 28:case"end":return t.stop()}}),t)})))()}})},S=C,F=(n(279),n(54)),component=Object(F.a)(S,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("SbModal",{attrs:{isOpen:e.exporting,"full-width":""},on:{hide:function(t){e.exporting=!1}}},[n("SbModalHeader",{attrs:{title:"Exporting data..."}}),e._v(" "),n("SbModalContent",[n("SbLoading",{attrs:{value:e.exportProgress,type:"bar","show-percentage":""}}),e._v(" "),n("p",{staticStyle:{"text-align":"center"}},[e._v(e._s(e.exportStatus))])],1)],1),e._v(" "),n("SbCard",[n("SbCardHeader",{staticClass:"header"},[n("SbButton",{attrs:{"has-icon-only":"",variant:"secondary",size:"small",icon:"chevron-back"},on:{click:function(t){return e.$router.go(-1)}}}),e._v(" "),n("h1",[e._v("Export Data")])],1),e._v(" "),n("SbCardContent",{staticClass:"content"},[n("SbFormItem",{attrs:{label:"Content Type","helper-icon-text":"Select a content type you want to export."}},[n("SbSelect",{staticStyle:{"max-width":"300px"},attrs:{options:e.contentTypes,label:"",isLoading:e.loadingComponents,itemLabel:"name",itemValue:"name",filterable:""},model:{value:e.contentType,callback:function(t){e.contentType=t},expression:"contentType"}})],1),e._v(" "),n("SbFormItem",{attrs:{label:"Content Folder","helper-icon-text":"Select a root content folder from where all stories with that content type will be export from."}},[n("SbSelect",{attrs:{label:e.breadcrumbs.map((function(b){return b.label})).join("/")}},[n("SbMinibrowser",{staticStyle:{"background-color":"white"},attrs:{slot:"minibrowser",notFoundPrefix:"",options:e.contentFoldersFiltered,breadcrumbs:e.breadcrumbs,isExpanded:"",isLoading:e.loadingContentFolder},on:{filter:e.filterContentFolder,"select-item":e.onContentFolderSelected,navigate:e.onNavigate,"clear-navigation":e.onClearNavigation},slot:"minibrowser"})],1)],1)],1),e._v(" "),n("SbCardFooter",[n("SbButton",{attrs:{label:"Export",isDisabled:!e.contentType},on:{click:e.exportData}})],1)],1)],1)}),[],!1,null,"4f756da6",null);t.default=component.exports}}]);